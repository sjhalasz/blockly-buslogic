<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Business Logic</title>
  <script src="blockly_compressed.js"></script>
  <script src="blocks_compressed.js"></script>
  <script src="en.js"></script>
  <script src="blocks.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  <h1>Blockly Demo of Business Logic</h1>

  <div id="blocklyDiv" style="height: 600px; width: 1200px;"></div>
  <textarea id="textarea" style="height: 600px; width: 1200px;"></textarea>

  <xml id="toolbox" style="display: none">
    <block type="settlement_days"></block>
    <block type="set_variable"></block>
    <block type="client"></block>
    <block type="conditional"></block>
    <block type="comparison"></block>
    <block type="conjunction"></block>
    <block type="variable"></block>
    <block type="value"></block>
  </xml>

  <script>
    var workspace = Blockly.inject('blocklyDiv', {toolbox: document.getElementById('toolbox')});
    function myUpdateFunction(event) {
      var dom = Blockly.Xml.workspaceToDom(workspace);
      document.getElementById('textarea').value = dom.innerHtml;
    }
    workspace.addChangeListener(myUpdateFunction);  
    function translateDom(dom){
      var r = "";
      var code = dom.childNodes[0]; // get code from <xml> wrapper
      if(code.childNodes.length !=1) throw 'expected exactly one root block';
      var root = code.childNodes[0]; // get one and only root block
      testAttribute(root, 'name', 'settlement_days');
    }
    function getAttribute(node, name){
      var attributes = node.attributes;
      for(var i = 0; i < attributes.length; i++){
        if(attributes[i].name == name) return attributes[i];
      }
    }
    function testAttribute(node, name, value){
      var attr = getAttribute(node, name);
      if((!attr) || attr.value != value) throw 'expected attribute ' + name + ' = ' + value;
    }
</script>

</body>
</html>
